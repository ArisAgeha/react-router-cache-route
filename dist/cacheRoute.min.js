!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","react-router-dom"],t):t(e.CacheRoute={},e.React,e.PropTypes,e.reactRouterDom)}(this,function(e,r,t,f){"use strict";var d="default"in r?r.default:r;t=t&&t.hasOwnProperty("default")?t.default:t;var i=function(e){return void 0===e},p=function(e){return null===e},u=function(e){return"string"==typeof e},l=function(e){return!(i(e)||p(e))},m=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2];t=u(t)?t.split("."):t;for(var n=void 0,c=e,o=0;o<t.length;o++){var a=t[o];if(!l(c))break;c=c[a]}return o===t.length&&(n=c),i(n)?r:n},s=function(e){for(var t=arguments.length,r=Array(2<t?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];c=u(c)?c.split("."):c;var o=m(e,c),a=m(e,c.slice(0,-1));return"function"==typeof o?o.call.apply(o,[a].concat(r)):o},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,c=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){c=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(c)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_={},w=16.3<=Number(m(s(d,"version.match",/^\d*\.\d*/),[0])),g=function(e,t){var r=e.match,n=e.when,c=void 0===n?"forward":n;if(m(r,"__CacheRoute__computedMatch__null")&&(r=null),!t.cached&&r)return{cached:!0,matched:!0};if(t.matched&&!r){var o=m(e,"history.action"),a=!1;switch(c){case"always":break;case"back":["PUSH","REPLACE"].includes(o)&&(a=!0);break;case"forward":default:"POP"===o&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!r}},O=function(e){function u(e){var t;h(this,u);for(var r=arguments.length,n=Array(1<r?r-1:0),c=1;c<r;c++)n[c-1]=arguments[c];var o,a,i=b(this,(t=u.__proto__||Object.getPrototypeOf(u)).call.apply(t,[this,e].concat(n)));return i.componentWillReceiveProps=w?void 0:function(e){i.setState(g(e,i.state))},i.cacheLifecycles={__listener:{},didCache:function(e){i.cacheLifecycles.__listener.didCache=e},didRecover:function(e){i.cacheLifecycles.__listener.didRecover=e}},e.cacheKey&&(o=e.cacheKey,a=i,_[o]=a),i.state=g(e,{cached:!1,matched:!1}),i}return c(u,e),n(u,[{key:"render",value:function(){var e=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return i(e)?s(t):s(e)},void 0)}(this.props.behavior(!this.state.matched),{}),t=e.className,r=void 0===t?"":t,n=v(e,["className"]),c=this.props.className,o=s((void 0===c?"":c)+" "+r,"trim"),a=""!==o;return this.state.cached?d.createElement("div",y({className:a?o:void 0},n),s(this.props,"children",this.cacheLifecycles)):null}}]),n(u,[{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached)return!0===t.matched&&!1===this.state.matched?s(this,"cacheLifecycles.__listener.didCache"):!1===t.matched&&!0===this.state.matched?s(this,"cacheLifecycles.__listener.didRecover"):void 0}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.matched||t.matched||this.state.cached!==t.cached}}]),u}(r.Component);O.propsTypes={history:t.object.isRequired,match:t.object.isRequired,children:t.func.isRequired,className:t.string,when:t.oneOf(["forward","back","always"]),behavior:t.func},O.defaultProps={when:"forward",behavior:function(e){return e?{style:{display:"none"}}:void 0}},O.getDerivedStateFromProps=w?g:void 0;var R=function(e){function a(){var e,t,r;h(this,a);for(var n=arguments.length,c=Array(n),o=0;o<n;o++)c[o]=arguments[o];return(t=r=b(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(c)))).render=function(){return r.props.render()},b(r,t)}return c(a,e),n(a,[{key:"shouldComponentUpdate",value:function(e){return l(e.match)&&!0!==m(e,"match.__CacheRoute__computedMatch__null")}}]),a}(r.Component);R.propsTypes={render:t.func.isRequired,match:t.object.isRequired};var a=function(e){function t(){return h(this,t),b(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),n(t,[{key:"render",value:function(){var e,t=this.props,r=t.children,n=t.render,c=t.component,o=t.className,a=t.when,i=t.behavior,u=t.cacheKey,l=v(t,["children","render","component","className","when","behavior","cacheKey"]);return(d.isValidElement(r)||(e=r,0!==d.Children.count(e)))&&(n=function(){return r}),d.createElement(f.Route,y({},l,{children:function(t){return d.createElement(O,y({},t,{when:a,className:o,behavior:i,cacheKey:u}),function(e){return d.createElement(R,{match:t.match,render:function(){return Object.assign(t,{cacheLifecycles:e}),c?d.createElement(c,t):s(n||r,void 0,t)}})})}}))}}]),t}(r.Component);a.componentName="CacheRoute",a.propTypes={component:t.elementType||t.any,render:t.func,children:t.oneOfType([t.func,t.node]),className:t.string,when:t.oneOf(["forward","back","always"]),behavior:t.func},a.defaultProps={when:"forward"};var C=function(){switch(!0){case l(r.PropTypes):return function(e){var t=e.children;return d.createElement("div",null,t)};case l(r.Fragment):return function(e){var t=e.children;return d.createElement(r.Fragment,null,t)};default:return function(e){return e.children}}}();C.displayName="SwitchFragment";var j=l(f.__RouterContext),P=function(e){function a(){var e,t,r;h(this,a);for(var n=arguments.length,c=Array(n),o=0;o<n;o++)c[o]=arguments[o];return(t=r=b(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(c)))).getContext=function(){if(j){var e=r.props;return{location:e.location,match:e.match}}var t=r.context.router.route;r.props.location||t.location;return{location:r.props.location||t.location,match:t.match}},b(r,t)}return c(a,e),n(a,[{key:"render",value:function(){var e=this.props.children,t=this.getContext(),s=t.location,h=(t.match,!1);return d.createElement(C,null,d.Children.map(e,function(e){if(!d.isValidElement(e))return null;var t=e.props,r=t.path,n=t.exact,c=t.strict,o=t.sensitive,a=t.from,i=r||a,u=h?null:f.matchPath(s.pathname,{path:i,exact:n,strict:c,sensitive:o},u),l=void 0;switch(m(e,"type.componentName")){case"CacheRoute":l=d.cloneElement(e,{location:s,computedMatch:p(u)?{__CacheRoute__computedMatch__null:!0}:u});break;default:l=u&&!h?d.cloneElement(e,{location:s,computedMatch:u}):null}return h||(h=!!u),l}))}}]),a}(f.Switch);j?(P.propTypes={children:t.node,location:t.object.isRequired,match:t.object.isRequired},P=f.withRouter(P)):(P.contextTypes={router:t.shape({route:t.object.isRequired}).isRequired},P.propTypes={children:t.node,location:t.object});var E=P;e.default=a,e.CacheRoute=a,e.CacheSwitch=E,e.dropByCacheKey=function(e){s(_,[e,"setState"],{cached:!1})},e.getCachingKeys=function(){return Object.entries(_).filter(function(e){return o(e,2)[1].state.cached}).map(function(e){return o(e,1)[0]})},e.clearCache=function(){Object.entries(_).filter(function(e){return o(e,2)[1].state.cached}).forEach(function(e){var t=o(e,1)[0];return s(_,[t,"setState"],{cached:!1})})},Object.defineProperty(e,"__esModule",{value:!0})});
