!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","react-router-dom"],t):t(e.CacheRoute={},e.React,e.PropTypes,e.reactRouterDom)}(this,function(e,r,t,p){"use strict";var m="default"in r?r.default:r;t=t&&t.hasOwnProperty("default")?t.default:t;var a=function(e){return void 0===e},u=function(e){return null===e},i=function(e){return"function"==typeof e},l=function(e){return"string"==typeof e},n=function(e){return!(a(e)||u(e))},o=function(e){return e instanceof Array},h=function(e){var t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=arguments[2];try{"number"==typeof(t=n)&&(r=t)==r&&(n=String(n));var c=(l(n)?n.split("."):n).reduce(function(e,t){return e[t]},e);return a(c)?o:c}catch(e){return o}},v=function(e){for(var t=arguments.length,r=Array(2<t?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];o=l(o)?o.split("."):o;var c=h(e,o),a=h(e,o.slice(0,-1));return i(c)?c.call.apply(c,[a].concat(r)):c},y=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return a(e)?v(t):v(e)},void 0)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),f=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},w=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw c}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},C=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},P=["overflow","overflow-x","overflow-y"],O=["auto","scroll"];function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;return[].concat(C(e.querySelectorAll("*")),[e]).filter(function(e){var t=getComputedStyle(e);return!e.saving&&P.some(function(e){return O.includes(t[e])})&&e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight})}function j(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,t=function r(e){return e.reduce(function(e,t){return[].concat(C(e),C(o(t)?r(t):[t]))},[])}((o(e)?e:[e]).map(R)).map(function(e){return e.saving=!0,[e,{x:e.scrollLeft,y:e.scrollTop}]});return function(){t.forEach(function(e){var t=g(e,2),r=t[0],n=t[1],o=n.x,c=n.y;r.scrollLeft=o,r.scrollTop=c,delete r.saving})}}var N={},S=function(){return Object.entries(N).filter(function(e){return g(e,2)[1].state.cached})},E=function(e){return v(N,[e,"setState"],{cached:!1})},T=16.3<=Number(h(v(m,"version.match",/^\d*\.\d*/),[0])),x="__isComputedUnmatch",A=function(e){return n(e)&&!0!==h(e,x)},q=function(e,t){var r=e.match,n=e.when,o=void 0===n?"forward":n;if(A(r)||(r=null),!t.cached&&r)return{cached:!0,matched:!0};if(t.matched&&!r){var c=h(e,"history.action"),a=!1;if(i(o))a=!o(e);else switch(o){case"always":break;case"back":["PUSH","REPLACE"].includes(c)&&(a=!0);break;case"forward":default:"POP"===c&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!r}},k=function(e){function u(e){var t;s(this,u);for(var r=arguments.length,n=Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var c,a,i=w(this,(t=u.__proto__||Object.getPrototypeOf(u)).call.apply(t,[this,e].concat(n)));return i.cacheLifecycles={__listener:{},didCache:function(e){i.cacheLifecycles.__listener.didCache=e},didRecover:function(e){i.cacheLifecycles.__listener.didRecover=e}},i.componentWillReceiveProps=T?void 0:function(e){var t=q(e,i.state);i.setState(t)},i.__cacheCreateTime=Date.now(),i.__cacheUpdateTime=i.__cacheCreateTime,e.cacheKey&&(c=e.cacheKey,a=i,N[c]=a),"undefined"!=typeof document&&(i.__placeholderNode=document.createComment(" Route cached "+(e.cacheKey?'with cacheKey: "'+e.cacheKey+'" ':""))),i.state=q(e,{cached:!1,matched:!1}),i}return d(u,e),c(u,[{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached){if(!0===t.matched&&!1===this.state.matched){if(this.props.unmount){var r=h(this.wrapper,"parentNode");this.__parentNode=r,v(this.__parentNode,"insertBefore",this.__placeholderNode,this.wrapper),v(this.__parentNode,"removeChild",this.wrapper)}return this.__cacheUpdateTime=Date.now(),v(this,"cacheLifecycles.__listener.didCache")}return!1===t.matched&&!0===this.state.matched?(this.props.saveScrollPosition&&v(this.__revertScrollPos),this.__cacheUpdateTime=Date.now(),v(this,"cacheLifecycles.__listener.didRecover")):void 0}}},{key:"shouldComponentUpdate",value:function(e,t){this.props.unmount&&(!1===this.state.matched&&!0===t.matched?(v(this.__parentNode,"insertBefore",this.wrapper,this.__placeholderNode),v(this.__parentNode,"removeChild",this.__placeholderNode)):this.props.saveScrollPosition&&(this.__revertScrollPos=j(this.wrapper)));return this.state.matched||t.matched||this.state.cached!==t.cached}},{key:"render",value:function(){var t=this,e=this.state,r=e.matched,n=e.cached,o=this.props,c=o.className,a=void 0===c?"":c,i=o.behavior,u=o.children,l=y(v(i,void 0,!r),{}),h=l.className,s=void 0===h?"":h,f=b(l,["className"]),p=v(a+" "+s,"trim"),d=""!==p;return n?m.createElement("div",_({className:d?p:void 0},f,{ref:function(e){t.wrapper=e}}),v(u,void 0,this.cacheLifecycles)):null}}]),u}(r.Component);k.propsTypes={history:t.object.isRequired,match:t.object.isRequired,children:t.func.isRequired,className:t.string,when:t.oneOfType([t.func,t.oneOf(["forward","back","always"])]),behavior:t.func,unmount:t.bool,saveScrollPosition:t.bool},k.defaultProps={when:"forward",unmount:!1,saveScrollPosition:!1,behavior:function(e){return e?{style:{display:"none"}}:void 0}},k.getDerivedStateFromProps=T?q:void 0;var K=function(e){function a(){var e,t,r;s(this,a);for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];return(t=r=w(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).render=function(){return v(r.props,"children")},r.shouldComponentUpdate=function(e){return e.when},w(r,t)}return d(a,e),a}(r.Component);K.propsTypes={when:t.bool.isRequired};var L=function(e){function t(){return s(this,t),w(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e,t=this.props,r=t.children,n=t.render,o=t.component,c=t.className,a=t.when,i=t.behavior,u=t.cacheKey,l=t.unmount,h=t.saveScrollPosition,s=t.computedMatchForCacheRoute,f=b(t,["children","render","component","className","when","behavior","cacheKey","unmount","saveScrollPosition","computedMatchForCacheRoute"]);return(m.isValidElement(r)||(e=r,0!==m.Children.count(e)))&&(n=function(){return r}),s&&(f.computedMatch=s),m.createElement(p.Route,f,function(t){return m.createElement(k,_({},t,{when:a,className:c,behavior:i,cacheKey:u,unmount:l,saveScrollPosition:h}),function(e){return m.createElement(K,{when:A(t.match)},function(){return Object.assign(t,{cacheLifecycles:e}),o?m.createElement(o,t):v(n||r,void 0,t)})})})}}]),t}(r.Component);L.componentName="CacheRoute",L.propTypes={component:t.elementType||t.any,render:t.func,children:t.oneOfType([t.func,t.node]),computedMatchForCacheRoute:t.object};var F=n(r.Fragment)?function(e){var t=e.children;return m.createElement(r.Fragment,null,t)}:n(r.PropTypes)?function(e){var t=e.children;return m.createElement("div",null,t)}:function(e){return e.children};F.displayName="SwitchFragment";var M=n(p.__RouterContext),U=function(e){function a(){var e,t,r;s(this,a);for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];return(t=r=w(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).getContext=function(){if(M){var e=r.props;return{location:e.location,match:e.match}}var t=r.context.router.route;r.props.location||t.location;return{location:r.props.location||t.location,match:t.match}},w(r,t)}return d(a,e),c(a,[{key:"render",value:function(){var e=this.props,t=e.children,o=e.which,r=this.getContext(),c=r.location,a=r.match,i=!1;return m.createElement(K,{when:A(a)},function(){return m.createElement(F,null,m.Children.map(t,function(e){if(!m.isValidElement(e))return null;var t=e.props.path||e.props.from,r=i?null:t?p.matchPath(c.pathname,_({},e.props,{path:t}),a):a,n=void 0;return n=o(e)?m.cloneElement(e,_({location:c,computedMatch:r},u(r)?{computedMatchForCacheRoute:f({},x,!0)}:null)):r&&!i?m.cloneElement(e,{location:c,computedMatch:r}):null,i||(i=!!r),n}))})}}]),a}(p.Switch);M?(U.propTypes={children:t.node,location:t.object.isRequired,match:t.object.isRequired,which:t.func},U=p.withRouter(U)):(U.contextTypes={router:t.shape({route:t.object.isRequired}).isRequired},U.propTypes={children:t.node,location:t.object,which:t.func}),U.defaultProps={which:function(e){return"CacheRoute"===y(h(e,"type.componentName"),h(e,"type.displayName"))}};var D=U;e.default=L,e.CacheRoute=L,e.CacheSwitch=D,e.dropByCacheKey=E,e.getCachingKeys=function(){return S().map(function(e){return g(e,1)[0]})},e.clearCache=function(){S().forEach(function(e){var t=g(e,1)[0];return E(t)})},e.getCachingComponents=function(){return S().reduce(function(e,t){var r=g(t,2),n=r[0],o=r[1];return _({},e,f({},n,o))},{})},Object.defineProperty(e,"__esModule",{value:!0})});
